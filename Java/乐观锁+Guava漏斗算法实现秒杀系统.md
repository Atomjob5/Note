<h1 style="display:flex;justify-content:center;align-items:center;color:#fff;background-image:linear-gradient( 135deg, #43CBFF 10%, #9708CC 100%);height:100px;box-shadow:0 5px 5px rgba(0,0,0,.05);">秒杀系统</h1>



# 1.秒杀系统

## 1.1秒杀场景

- 电商抢购限量商品
- 演唱会门票
- 火车票



## 1.2为什么

- 严格防止超卖
- 防止黑产
- 保护用户体验



## 1.3保护措施

- 乐观锁防止超卖
- 令牌桶限流
- `Redis`缓存

- 消息队列异步处理订单





悲观锁

```java
//使用同步代码块
//线程去等待锁的释放，然后去抢锁
public void kill(){
    syncronize(this){
        //业务逻辑
        ...
    }
}
```



乐观锁

> 使用数据库的乐观锁，加一个`version`字段，更新同时查询主键和`version`两个字段





# 2.接口限流

## 2.1接口限流

在面临高并发的抢购请求时，我们如果不对接口进行限流，可能会对后台系统造成极大的压力。大量的请求抢购成功时候需要调用下单接口，过多的请求在打到数据库会对系统的稳定性和造成影响

## 2.2如何解决接口限流

常用的限流算法有`令牌桶`和`漏桶（漏斗算法）`，Google的开源项目Guava中的RateLimiter使用的就是令牌桶控制算法。在开发高并发系统时三把利器来保护系统：`缓存`、`降级` 和 `限流` 

- 缓存：缓存的目的是提升系统访问速度和增大系统处理容量
- 降级：降级是当服务器压力剧增的情况下，根据当前业务情况及流量对一些服务和页面有策略升级，以此来释放服务器资源以保证核心任务的正常进行
- 限流：限流的目的是通过对并发访问/请求进行限速，或者对一个时间窗口内的请求进行限速来保护系统，一旦打到限制速率则可以拒绝服务、排队或等待、降级等处理